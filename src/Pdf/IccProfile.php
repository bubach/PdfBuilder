<?php
namespace PdfBuilder\Pdf;

use PdfBuilder\Document;
use PdfBuilder\Stream\Stream;

class IccProfile extends ObjectStructure
{
    /**
     * @var array  Default IEC61966-2.1 color coding, pre-compressed.
     */
    protected static $iec_1966_2_1 = [
        0x789ced99, 0x67505459, 0x1680ef7b, 0xaf73a0a1, 0xbb693234, 0x394994d0, 0x80e49c24, 0x475181ee, 0x26d34293,
        0xc1880c8e, 0xc0082222, 0x49114414, 0x70c0d121, 0xc8282aa2, 0x18100505, 0xccd3c820, 0xa08c83a3, 0x888aca02,
        0xfe98adda, 0xaddddaaa, 0xadfdb37d, 0x7ebcf7d5, 0xb9a7de39, 0xf7d5ad7a, 0x5fd50340, 0x8690c04e, 0x4c81f501,
        0x48e4a5f2, 0x7d9ded98, 0xc121a14c, 0xec7d8003, 0x64400254, 0x808960a7, 0x2479fa39, 0xf983e558, 0xa905ff10,
        0xef4701b4, 0x72bfa7f3, 0xcfd7ff65, 0x9038893c, 0x0e00107d, 0x99e338dc, 0x14f632ef, 0x5ce6184e, 0x2267253f,
        0xbdc219a9, 0x49a900c0, 0xdecb4ce7, 0x2f0fb8cc, 0x9c158efc, 0xc6992b1c, 0xfd8d8b56, 0x6bfc7ded, 0x97f92800,
        0x3852f42a, 0x134ead70, 0xe42a53bb, 0x56981dc3, 0x4f0440ba, 0x6fb95e85, 0x9dc45f7e, 0xbef44a2f, 0xc56f33ac,
        0x86e8ca7e, 0x98d15c1e, 0x971f91ca, 0xe530ffc3, 0xadfdfbf8, 0xbb5ee894, 0xe597ff5f, 0x6ff03fee, 0xb37276be,
        0xd15bcbd5, 0x3301312a, 0xfeca6d29, 0x0380f51a, 0x00a4e4af, 0x9cca6100, 0x28bb01e8, 0xe8f92b17, 0x791c80ce,
        0x1200249f, 0xb1d3f8e9, 0xdf72a8d5, 0xd9010150, 0x001d4801, 0x79a00c34, 0x800e3004, 0xa6c002d8, 0x0047e006,
        0xbc803f08, 0x019b001b, 0xc48044c0, 0x0719602b, 0xd805f241, 0x21280107, 0x4115a805, 0x0da009b4, 0x8233a013,
        0x9c0797c1, 0x35700bdc, 0x0523e031, 0x108049f0, 0x0acc81f7, 0x60118220, 0x2c448668, 0x9014a400, 0xa942da90,
        0x21c482ac, 0x2047c803, 0xf28542a0, 0x70281ae2, 0x4169d056, 0x68375408, 0x95425550, 0x1dd404fd, 0x049d832e,
        0x4337a021, 0xe821340e, 0xcd407f42, 0x9f600426, 0xc174580e, 0x5683f560, 0x166c0bbb, 0xc3fef046, 0x381a4e86,
        0xb3e13c78, 0x1f5c01d7, 0xc3a7e00e, 0xf8327c0b, 0x1e8105f0, 0x2b781e01, 0x08116120, 0x8a880ec2, 0x42ec112f,
        0x24148942, 0xf8c876a4, 0x002947ea, 0x9156a41b, 0xe947ee21, 0x026416f9, 0x88c2a068, 0x28264a07, 0x65817241,
        0x05a0d8a8, 0x64d47654, 0x11aa0a75, 0x12d581ea, 0x43dd438d, 0xa3e6505f, 0xd164b42c, 0x5a1b6d8e, 0x764507a3,
        0xa3d119e8, 0x7c7439ba, 0x11dd8ebe, 0x8a1e414f, 0xa2df6330, 0x1806461d, 0x638a71c1, 0x8460e230, 0x399822cc,
        0x614c1be6, 0x12660833, 0x8199c762, 0xb152586d, 0xac25d60b, 0x1b814dc5, 0xe6632bb1, 0xa7b017b1, 0xc3d849ec,
        0x071c11a7, 0x8033c439, 0xe142713c, 0x5c2eae1c, 0xd78cebc1, 0x0de3a670, 0x8b7851bc, 0x2ade1cef, 0x85e7e0b3,
        0xf0c5f806, 0x7c37fe0e, 0x7e12bf48, 0x1023a813, 0x2c09fe84, 0x38c22e42, 0x05a19570, 0x95f084f0, 0x9648242a,
        0x11cd883e, 0xc458e24e, 0x6205f134, 0xf13a719c, 0xf8914425, 0x6991ec49, 0x61a434d2, 0x3ed209d2, 0x25d243d2,
        0x5b3299ac, 0x46b62187, 0x9253c9fb, 0xc84de42b, 0xe467e40f, 0x2234115d, 0x1157118e, 0xc80e916a, 0x910e9161,
        0x91d7143c, 0x4595624b, 0xd944c9a6, 0x9453ce52, 0xee506645, 0xf1a26aa2, 0xf6a211a2, 0xdb45ab45, 0xcf898e89,
        0xce8bd1c4, 0x0cc4bcc4, 0x12c58ac4, 0x9ac56e88, 0x4d53b154, 0x35aa2395, 0x43cda31e, 0xa35ea14e, 0xd0109a32,
        0xcd9ec6a6, 0xeda635d0, 0xaed226e9, 0x18ba3add, 0x951e472f, 0xa4ff481f, 0xa4cf8953, 0xc58dc403, 0xc533c5ab,
        0xc52f880b, 0x1808438d, 0xe1ca4860, 0x1433ce30, 0x46199f24, 0xe4246c25, 0xb8127b25, 0x5a258625, 0x16246524,
        0x6d24b992, 0x05926d92, 0x23929fa4, 0x98528e52, 0xf152fba5, 0x3aa59e4a, 0xa3a4b5a4, 0x7da433a4, 0x8f485f95,
        0x9e95a1cb, 0x58c8b065, 0x0a64cec8, 0x3c928565, 0xb5647d65, 0x73648fc9, 0x0ec8cecb, 0xc9cb39cb, 0x25c955ca,
        0x5d919b95, 0x67c8dbc8, 0xc7c997c9, 0xf7c8cf28, 0xd014ac14, 0x6215ca14, 0x2e2abc64, 0x8a336d99, 0x09cc0a66,
        0x1f734e51, 0x56d14531, 0x4db14e71, 0x50715149, 0x5d294029, 0x57a94de9, 0xa9324199, 0xa51ca55c, 0xa6dcab3c,
        0xa7a2a0e2, 0xa9b255a5, 0x45e5912a, 0x5e95a51a, 0xa37a48b5, 0x5f75414d, 0x5d2d486d, 0x8f5aa7da, 0xb4baa4ba,
        0xab7ab67a, 0x8bfa130d, 0xb286b546, 0xb246bdc6, 0x7d4d8c26, 0x4b335ef3, 0xb0e65d2d, 0x58cb582b, 0x46ab5aeb,
        0x8e36ac6d, 0xa21dab7d, 0x587b680d, 0x7a8dd91a, 0xde9afa35, 0x633a241d, 0x5b9d749d, 0x169d715d, 0x86ae876e,
        0xae6ea7ee, 0x6b3d15bd, 0x50bdfd7a, 0xfd7a5ff5, 0x8df513f4, 0x1bf41f1b, 0x500ddc0c, 0x720dba0d, 0xfe34d432,
        0x641b561b, 0xde5f4b5e, 0xebb476c7, 0xdaaeb56f, 0x8cb48db8, 0x46478c1e, 0x18d38c3d, 0x8df718f7, 0x1a7f3131,
        0x35e19bb4, 0x9acc98aa, 0x98869bd6, 0x988eb1e8, 0x2c6f5611, 0xebba19da, 0xccce6c87, 0xd979b38f, 0xe626e6a9,
        0xe667ccff, 0xb0d0b188, 0xb768b698, 0x5ea7be8e, 0xbbae61dd, 0x84a59265, 0x84659da5, 0xc08a6915, 0x6e75d44a,
        0x60ad681d, 0x615d6ffd, 0xdc46d986, 0x63d36833, 0x65ab691b, 0x677bcaf6, 0xb59dbe1d, 0xdfaedd6e, 0xc1dedc7e,
        0x9bfd2507, 0xc4c1d9a1, 0xc061d091, 0xea18e058, 0xe5f8cc49, 0xc929daa9, 0xc569ced9, 0xd839c7f9, 0x920bdac5,
        0xdd65bfcb, 0x98ab9c2b, 0xdbb5c975, 0xcecdd46d, 0x9b5b9f3b, 0xc9ddcfbd, 0xcafdb987, 0x9607dfa3, 0xdb13f674,
        0xf33ce0f9, 0x64bdea7a, 0xdefa4e2f, 0xe0e5ea75, 0xc0eba9b7, 0xba77b2f7, 0x2f3e181f, 0x6f9f6a9f, 0x17be06be,
        0x5b7dfbfd, 0x687e9bfd, 0x9afddefb, 0xdbf917fb, 0x3f0ed008, 0x480be80d, 0xa4048605, 0x36052e04, 0x39049506,
        0x0982f582, 0xb705df0a, 0x910e890d, 0xe90ac586, 0x06863686, 0xce6f70dc, 0x7070c364, 0x9871587e, 0xd8e846f5,
        0x8d991b6f, 0x6c92de94, 0xb0e9c266, 0xcae688cd, 0x67c3d1e1, 0x41e1cde1, 0x9f23bc22, 0xea23e623, 0x5d236b22,
        0xe7d8f6ec, 0x43ec571c, 0x1b4e1967, 0x866bc92d, 0xe54e4559, 0x4695464d, 0x475b461f, 0x889e89b1, 0x8e298f99,
        0x8db58fad, 0x8a7d13e7, 0x12571bb7, 0x10ef157f, 0x227e2921, 0x28a12d11, 0x97189e78, 0x8e47e5c5, 0xf3fab6c8,
        0x6fc9dc32, 0x94a49d94, 0x9f244836, 0x4f3e983c, 0xc777e737, 0xa640291b, 0x53ba52e9, 0xcb1fe981, 0x348db4ef,
        0xd2c6d3ad, 0xd2abd33f, 0x6404669c, 0xcd14cbe4, 0x650e6469, 0x65edcd9a, 0xca76ca3e, 0x9e83ca61, 0xe7f46e55,
        0xdcba6beb, 0xf836db6d, 0x75dba1ed, 0x91db7b77, 0x28efc8db, 0x31b9d379, 0xe7c95d84, 0x5df1bb6e, 0xe7eae796,
        0xe6bedb1d, 0xb4bb3b4f, 0x2e6f67de, 0xc477cedf, 0xb5e48be4, 0xf3f3c7f6, 0x58eca9fd, 0x1ef57dec, 0xf7837bd7,
        0xeeaddcfb, 0xb5805370, 0xb350bfb0, 0xbcf07311, 0xbbe8e60f, 0x063f54fc, 0xb0b42f6a, 0xdf60b149, 0xf191124c,
        0x09af6474, 0xbff5fe93, 0xa562a5d9, 0xa513073c, 0x0f749431, 0xcb0acade, 0x1ddc7cf0, 0x46b95179, 0xed21c2a1,
        0xb443820a, 0x8f8aae4a, 0x95ca92ca, 0xcf553155, 0x23d576d5, 0x6d35b235, 0x7b6b160e, 0x730e0f1f, 0xb139d25a,
        0x2b575b58, 0xfbe968ec, 0xd10775ce, 0x751df56a, 0xf5e5c730, 0xc7d28fbd, 0x68086ce8, 0x3fce3ade, 0xd428dd58,
        0xd8f8e504, 0xef84e0a4, 0xefc9be26, 0xd3a6a666, 0xd9e6e216, 0xb825ad65, 0xe654d8a9, 0xbb3f3afc, 0xd8d5aad3,
        0x5ad7c668, 0x2b3c0d4e, 0xa79d7ef9, 0x53f84fa3, 0x67dccff4, 0x9e659d6d, 0xfd59f5e7, 0x9a765a7b, 0x4107d491,
        0xd531d719, 0xd329e80a, 0xe91a3ae7, 0x76aeb7db, 0xa2bbfd17, 0xdd5f4e9c, 0x573c5f7d, 0x41fc4271, 0x0fa127af,
        0x67e962f6, 0xc5f94b49, 0x97662f47, 0x5f9ee8dd, 0xdcfbf84a, 0xf095fb7d, 0x3e7d8357, 0xddaf5ebf, 0xe674ed4a,
        0xbf6dffc5, 0xeb96d7cf, 0xdf30bf71, 0xee26eb66, 0xe72d935b, 0x1d03c603, 0xedb78d6f, 0xb70f9a0c, 0x76dc31bd,
        0xd375d7ec, 0x6ef7d0ba, 0xa19e61eb, 0xe1cbf71c, 0xee5dbbef, 0x7affd6c8, 0xfa91a1d1, 0x80d10763, 0x61638207,
        0x9c07d30f, 0x131ebe79, 0x94fe68f1, 0xf1ce27e8, 0x27054f45, 0x9f963f93, 0x7d56ffab, 0xe6af6d02, 0x13c18571,
        0x87f181e7, 0x7ecf1f4f, 0xb0275efd, 0x96f2dbe7, 0xc9bc17e4, 0x17e5530a, 0x534dd386, 0xd3e7679c, 0x66eebedc,
        0xf072f255, 0xd2abc5d9, 0xfcdfc57e, 0xaf79adf1, 0xfae73f6c, 0xfe18980b, 0x9e9b7cc3, 0x7fb3f467, 0xd15ba9b7,
        0x27de19bd, 0xeb9df79e, 0x7ff63ef1, 0xfde242c1, 0x07a90f27, 0x3fb23ef6, 0x7f0afa34, 0xb598f119, 0xfbb9e28b,
        0xe697eeaf, 0xee5f9f2c, 0x252e2d09, 0x5d40e802, 0x421710ba, 0x80d00584, 0x2e207401, 0xa10b085d, 0x40e80242,
        0x1710ba80, 0xd005842e, 0x207481ff, 0x631758fd, 0x8fb31cc8, 0xcae5d818, 0x00fe3900, 0x78dc06a0, 0xb20a00b5,
        0x28002861, 0xa9dcccd4, 0x9555de16, 0x267b4b52, 0x163f363a, 0x26750d33, 0x2d85cb8c, 0xe273b909, 0x5980f037,
        0x0e7f0a1d
    ];

    /**
     * Get array values for the Catalog OutputIntents-entry.
     *
     * @return string
     */
    public function getOutputIntentsArrayValue()
    {
        $structure = [];
        $structure['Type'] = $this->escapeValue('OutputIntent', self::NAME);
        $structure['S'] = $this->escapeValue('GTS_PDFA1', self::NAME);
        $structure['OutputCondition'] = $this->escapeValue('sRGB IEC61966-2.1', self::STRING);
        $structure['OutputConditionIdentifier'] = $this->escapeValue('sRGB IEC61966-2.1', self::STRING);
        $structure['RegistryName'] = $this->escapeValue('http://www.color.org', self::STRING);
        $structure['Info'] = $this->escapeValue('sRGB IEC61966-2.1', self::STRING);
        $structure['DestOutputProfile'] = $this->getReference(true);

        $val = "\n        <<" . $this->process($structure, 2) . "\n        >>";

        $structure = [];
        $structure['Type'] = $this->escapeValue('OutputIntent', self::NAME);
        $structure['S'] = $this->escapeValue('GTS_PDFX', self::NAME);
        $structure['OutputConditionIdentifier'] = $this->escapeValue('OFCOM_PO_P1_F60_95', self::STRING);
        $structure['RegistryName'] = $this->escapeValue('http://www.color.org', self::STRING);
        $structure['Info'] = $this->escapeValue('OFCOM_PO_P1_F60_95', self::STRING);

        return $val  . "\n        <<" . $this->process($structure, 2) . "\n        >>";
    }

    /**
     * Get ICC stream
     *
     * @param  null|Document $document
     * @return Stream[]
     */
    public function getStreams($document = null)
    {
        $this->setValue('N', 3);
        $this->setName('Filter', 'FlateDecode');

        $stream = new Stream();
        foreach (self::$iec_1966_2_1 as $unsigned32) {
            $stream->write(pack('N', $unsigned32), 4);
        }

        $this->setValue('Length', $stream->getSize());
        $this->writeDataStream($stream, false);

        return parent::getStreams($document);
    }
}
